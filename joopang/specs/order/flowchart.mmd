flowchart TD
    A[주문 요청 수신<br/>장바구니 → 체크아웃] --> B[기본 유효성 검증]
    B --> C[재고 차감/예약]
    C -->|재고 부족| F[주문 실패 반환]
    C -->|성공| D[할인 계산<br/>쿠폰·포인트]
    D -->|쿠폰 만료/사용 불가| J[재고 예약 해제 & 실패 응답]
    D -->|할인 적용| E[결제 대상 금액 산출]
    subgraph T[주문 트랜잭션 경계]
        direction TB
        E --> G[주문 생성<br/>orders · order_items]
        G --> H[결제 요청]
    end
    H -->|결제 성공| I[주문 상태 업데이트<br/>PAID]
    H -->|결제 실패| J
    I --> K[배송 정보 생성<br/>deliveries]
    K --> L[데이터 플랫폼 전송]
    J --> M[주문 취소 & 트랜잭션 롤백]
    M --> F
