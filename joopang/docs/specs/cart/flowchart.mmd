flowchart TD
    A[상품 상세/목록 노출] --> B[사용자 장바구니 담기 이벤트]
    B --> C{로그인 여부}
    C -->|No| L[로그인 요청]
    C -->|Yes| D[상품/옵션 선택값 검증]
    D --> E[상품/옵션 상태 조회\nProduct Service]
    E --> F{판매 가능?}
    F -->|No| M[담기 불가 안내]
    F -->|Yes| G[재고 서비스에 수량 확인]
    G --> H{요청 수량 가능?}
    H -->|No| N[수량 조정 또는 실패 응답]
    H -->|Yes| I[장바구니 항목 조회]
    I --> J{기존 항목 존재?}
    J -->|Yes| O[수량/옵션 업데이트]
    J -->|No| P[신규 항목 생성]
    O --> Q[카트 상태 동기화]
    P --> Q
    Q --> R[장바구니 요약 반환]
    R --> S[프론트 표시/토스트]
    S --> T[이벤트 로깅/데이터 전송]
