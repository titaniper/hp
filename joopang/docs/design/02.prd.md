# 제품 요구사항 문서(Product Requirements Document)

> **참고**: 본 문서는 [비즈니스 요구사항 문서(BRD)](brd.md)를 제품 관점에서 구체화한 산출물입니다. 아키텍처 및 설계 세부사항은 [docs/architecture.md](../architecture.md)와 [docs/design/api-specification.md](api-specification.md)를 참고하세요.

## 1. 제품 개요
- **제품명**: 주팡(joopang) 커머스 플랫폼
- **목표 시장**: 대한민국(KR) 및 미국(US)
- **핵심 가치 제안**: 실시간 재고/결제/쿠폰을 안정적으로 처리하면서, 시장별 현지화와 외부 데이터 연동을 지원하는 이커머스 백엔드 서비스
- **제품 범위**
  - 고객용 퍼블릭 API: 상품 탐색, 장바구니, 주문/결제, 쿠폰 발급
  - 내부/관리자용 API: 재고 조정, 쿠폰 정책 관리, 운영 모니터링
  - 이벤트/데이터 파이프라인: 주문/쿠폰 이벤트의 아웃박스 전송

## 2. 제품 목표 및 성공 지표
| 목표 | 성공 지표(KPI) | 기준선 | 1차 릴리스 목표 |
| --- | --- | --- | --- |
| 안정적 주문 처리 | 주문 완료율(결제 성공/시도) | N/A | ≥ 96% |
| 재고 정확도 보장 | 재고 불일치 발생률 | N/A | 월 3건 이하 |
| 쿠폰 캠페인 지원 | 쿠폰 소진률(목표 대비) | N/A | 80% 이상/캠페인 |
| 현지화 경험 제공 | 다국어/통화 오류 비율 | N/A | 전체 요청의 1% 미만 |
| 운영 효율성 | 운영자 수동 개입 건수 | N/A | 전체 주문의 2% 이하 |

## 3. 주요 사용자 및 페르소나
| 페르소나 | 설명 | 핵심 목표 | 대표 기능 |
| --- | --- | --- | --- |
| **게스트 사용자** | 로그인하지 않은 방문자 | 빠르게 상품 탐색 및 재고 확인 | 상품 카탈로그 조회, 세션 장바구니 |
| **회원 고객** | 인증된 구매자 | 쿠폰 혜택을 활용한 원활한 구매 | 장바구니 저장, 쿠폰 발급/적용, 주문/결제 |
| **고객 상담사** | CS 담당자 | 고객 요청 처리 및 주문 상태 확인 | 주문/쿠폰 조회, 제한적 환불 |
| **재고 관리자** | 물류팀 | 재고 정확도 유지 | 재고 조정, 감사 로그 조회 |
| **마케팅 관리자** | 프로모션 담당자 | 쿠폰 캠페인 기획/운영 | 쿠폰 정책 등록, 발급 현황 모니터링 |
| **운영 관리자** | 플랫폼 운영 총괄 | 전반적인 안정성 확보 | 시스템 설정, 강제 처리, 역할 관리 |
| **외부 데이터 플랫폼** | BI/분석 시스템 | 주문/쿠폰 데이터 수신 | 아웃박스 이벤트 수신, 재전송 요청 |

## 4. 핵심 사용자 여정
1. **상품 탐색**
   1. 시장/언어 자동 판별 후 카탈로그 요청
   2. 필터/정렬 적용 → 실시간 가격·재고·프로모션 정보 반환
   3. 인기 상품(최근 3일 Top5) 노출
2. **장바구니 & 쿠폰 준비**
   1. 상품 스펙 선택 후 장바구니에 추가
   2. 수량 검증 및 재고 한도 확인
   3. 쿠폰 발급 가능 여부 사전 검증 및 발급
3. **주문 & 결제**
   1. 멱등 키 기반 주문 생성 요청
   2. 재고 예약 → 쿠폰 할인 → 지갑 잔액 차감
   3. 결제 성공 시 재고 차감, 외부 데이터 전송 큐잉
4. **사후 처리**
   1. 주문 상태 추적(PENDING→PAID→FULFILLED)
   2. 취소/환불 가능 시점 노출
   3. 쿠폰 사용 이력 및 잔량 모니터링

## 5. 기능 요구사항 (제품 관점 세분화)
### 5.1 카탈로그/상품
- F-PROD-01: 카테고리, 가격, 인기, 최신 기준으로 필터/정렬 가능한 목록 API 제공
- F-PROD-02: 시장별 현지화(언어/통화) 메타데이터 및 재고/가격 동기화
- F-PROD-03: 최근 3일 Top5 인기 상품 API (시장별)
- 수용 기준
  - 요청 헤더 기반 로캘 적용
  - 재고/가격 정보는 최대 1분 이내 최신 데이터

### 5.2 재고
- F-STOCK-01: SKU 단위 실시간 재고 조회 및 예약 API
- F-STOCK-02: 재고 보정/입고/감사 로그 관리 API
- F-STOCK-03: 재고 변경 이벤트를 아웃박스로 저장
- 수용 기준
  - 예약 시간 초과 시 자동 해제(기본 10분)
  - 감사 로그에는 담당자, 사유, 변경량 필수

### 5.3 장바구니
- F-CART-01: 회원 장바구니 영속화, 비회원 세션 장바구니 지원
- F-CART-02: 상품 추가/수정/삭제 시 한도 및 재고 검증
- F-CART-03: 예상 결제 금액, 세금, 배송비(간이 룰 기반) 계산 API

### 5.4 주문 & 결제
- F-ORDER-01: 멱등 키 기반 주문 생성(중복 요청 시 동일 응답 반환)
- F-ORDER-02: 주문 상태 관리 API (`PENDING`, `PAID`, `FULFILLED`, `CANCELLED`, `REFUNDED`)
- F-ORDER-03: 주문 상세/이력 조회 및 상태별 취소 조건
- F-PAY-01: 주팡 지갑 잔액 결제 및 환불 API
- F-PAY-02: 잔액 조회, 거래 내역, 멱등 결제 토큰 처리
- 수용 기준
  - 결제 성공 시 재고 차감 후 외부 연동 큐 등록
  - 실패 시 명확한 오류 코드 반환 (`ErrorCodes` 사용)

### 5.5 쿠폰
- F-COUPON-01: 한정 수량 선착순 발급 및 락 기반 중복 방지
- F-COUPON-02: 쿠폰 적격성 검증(기간/횟수/상품/시장)
- F-COUPON-03: 쿠폰 사용 이력 및 관리자 회수 기능
- 수용 기준
  - 발급 시 잔량 감소, 사용 시 사용 이력 기록
  - 쿠폰 미적용 사유를 명시한 오류 메시지

### 5.6 외부 데이터 연동
- F-DATA-01: 주문/쿠폰 이벤트 아웃박스 적재
- F-DATA-02: 외부 플랫폼 연동(비동기 전송, 재시도, 상태 모니터링)
- 수용 기준
  - 전송 실패 시 재시도/지연 상태 표시
  - 전송 실패가 주문 완료를 차단하지 않아야 함

### 5.7 현지화 & 규제
- F-LOC-01: 통화 변환 및 반올림 규칙 적용
- F-LOC-02: 다국어 메시지 제공(한글/영문)
- F-LOC-03: 시장별 전자 영수증, 반품 정책 설정

### 5.8 운영/관측성
- F-OPS-01: 구조화된 감사 로그 및 이벤트 로그 수집
- F-OPS-02: 주요 지표(재고 예약 지연, 주문 완료율, 쿠폰 발급 성공률) 모니터링
- F-OPS-03: 알림 및 대시보드 API 제공

## 6. 비기능 요구사항 요약
- **가용성**: 핵심 API 99.9% 이상 (월간 다운타임 ≤ 43분)
- **성능**: 읽기 API P95 200ms, 쓰기 API P95 400ms, 재고 검증 100ms 이하
- **확장성**: 도메인별 수평 확장 및 쿠폰 발급 플래시 트래픽 처리
- **일관성**: 재고/쿠폰 강한 일관성, 분석 데이터 최종적 일관성
- **보안**: OAuth2/JWT 기반 인증, RBAC, TLS, 데이터 암호화, 규제 준수
- **관측성**: 로그/메트릭/분산 추적, 재시도 정책 및 회로 차단기

## 7. 출시 로드맵 (제안)
| 단계 | 범위 | 핵심 기능 | 비고 |
| --- | --- | --- | --- |
| **MVP (Sprint 1-3)** | KR 시장 단일 통화, 기본 쿠폰, 인메모리 어댑터 | 상품 조회, 장바구니, 주문/결제(지갑), 쿠폰 발급, 재고 예약, 아웃박스 저장 | 외부 전송은 Mock, 관리자 기능 최소화 |
| **Phase 2 (Sprint 4-6)** | US 시장 추가, 외부 데이터 플랫폼 연동 | 다국어/통화, 실데이터 전송, 운영 대시보드, 재고 감사 로그 | 실제 메시지 큐/DB 연동 |
| **Phase 3 (Sprint 7+)** | 고급 마케팅/운영 기능 | 쿠폰 회수/통계, 환불 자동화, 재고 멀티 로케이션, 알림 고도화 | 성능 튜닝 및 확장성 검증 |

## 8. 의존성 및 리스크
- **외부 시스템**: 환율/세금 계산 서비스, 외부 데이터 플랫폼 API
- **기술적 리스크**: 플래시 세일 쿠폰 발급 시 락 경합, 아웃박스 이벤트 누락 가능성
- **운영 리스크**: 현지화된 정책 유지 관리, 관리자 권한 오남용
- **완화 전략**
  - 레디스/분산 락 시험 및 부하 테스트
  - 아웃박스 재전송/데드레터 큐 설계
  - RBAC 및 감사 로그 강화

## 9. 측정 및 모니터링 계획
- **핵심 지표**: 주문 완료율, 재고 예약 성공률, 쿠폰 발급 성공률, 외부 전송 실패율
- **경보 조건**:
  - 주문 실패율 > 5% (10분 평균)
  - 쿠폰 발급 실패율 > 10% (캠페인 단위)
  - 외부 전송 지연 5분 초과 이벤트 3건 이상
- **리포트**: 시장별 일매출, 카테고리별 판매량, 쿠폰 사용률 (일/주간)

## 10. 참고 문서
- [docs/architecture.md](../architecture.md)
- [docs/design/api-specification.md](api-specification.md)
- [docs/design/erd.md](erd.md)
- [docs/design/requirements.md](requirements.md)
- [docs/design/tasks.md](tasks.md)
- [docs/design/user-stories.md](user-stories.md)
