# Architecture Overview
- **Style** 단일 Spring Boot 애플리케이션 안에서 도메인별(`order`, `coupon`, `product`, `user`, `payment`, `seller`, `category`, `metrics`, `cart`, `delivery`)로 나뉜 헥사고날(ports & adapters) 구조를 따른다. 각 도메인은 `presentation → application → domain → infrastructure` 방향으로만 의존하며, 도메인 계층이 가장 안쪽(core)으로 위치한다.

## Runtime Stack
- Kotlin 1.9, JDK 17
- Spring Boot 3.2 (Web MVC, Validation, Jackson Kotlin Module)
- Gradle Kotlin DSL + Version Catalog(`gradle/libs.versions.toml`) 기반 의존성 관리
- Springdoc OpenAPI 스타터 의존성이 추가돼 있으며, Swagger UI 구성이 `config/OpenApiConfig.kt`에 존재한다.

## Module & Package Layout
- `io.joopang.services.<domain>` 구조로 도메인을 구분한다.
  - `presentation`: REST 어댑터 계층. 예) `services/order/presentation/OrderController.kt`
  - `application`: 유스케이스/서비스 계층. 예) `services/order/application/OrderService.kt`
  - `domain`: 엔티티, 값 객체, 도메인 서비스, 예외 등 순수 도메인 모델. 예) `services/order/domain/Order.kt`
  - `infrastructure`: 메모리/외부 시스템 어댑터 구현체. 예) `services/order/infrastructure/OrderRepository.kt`
- 공통 관심사는 `services/common` 아래에 집약하였다.
  - `application/ErrorResponse.kt`: 표준 에러 응답 DTO
  - `presentation/ApiControllerAdvice.kt`: 전역 예외 처리기
  - `domain/ErrorCodes.kt`: 서비스 전반에서 활용하는 에러 코드 정의
  - `infrastructure/CacheServiceImpl.kt`: 공용 캐시 어댑터
- 일부 도메인은 아직 구현이 없어 특정 계층 디렉터리가 비어 있을 수 있다.
- 주요 요청 플로우 예시(`order` 도메인):
  ```
  presentation -> application (유스케이스) -> domain (엔티티/도메인 서비스)
              \-> infrastructure (저장소, 외부 연동)
  ```
- 여전히 단일 Gradle 모듈 구조지만, 패키지 레벨에서 도메인 격리와 의존 방향을 명확히 했다.

## Request Handling Flow
1. `presentation` 계층이 HTTP 요청을 받고 입력 DTO를 애플리케이션 계층으로 전달한다.
2. `application` 계층은 도메인 모델을 조합하며 트랜잭션/워크플로를 담당한다.
3. `domain` 계층 엔티티/값 객체가 핵심 비즈니스 규칙을 보장한다.
4. `infrastructure` 계층 구현체가 저장소/외부 연동을 담당하며, 애플리케이션 계층에서 포트(인터페이스) 형태로 주입받는다.
5. 예외 발생 시 `services/common/presentation/ApiControllerAdvice.kt`가 `ErrorResponse`를 만들어 반환한다.

## Cross-Cutting Concerns
- **에러 표준화**: `ErrorCode` + `ApiControllerAdvice` 조합으로 모든 도메인에서 일관된 오류 응답을 생성한다.
- **캐시 추상화**: `services/common/application/CacheService.kt`와 `infrastructure/CacheServiceImpl.kt`로 도메인에 독립적인 캐시 인터페이스를 제공한다.
- **OpenAPI 문서화**: `config/OpenApiConfig.kt`에서 Swagger UI 경로 및 기본 메타데이터를 노출한다.

## Architecture Notes & Next Steps
- 현재 인프라 계층 구현체는 인메모리 기반이며, 실제 DB/메시징/외부 API 연동이 추가되면 도메인 의존성을 해치지 않고 어댑터만 교체하면 된다.
- 각 도메인에 대한 테스트/계약 검증은 계층 경계를 따라 모듈화할 수 있다.
- 추가 개선 아이디어
  1. 공통 DTO·유틸을 위한 `services/shared` 등 별도 계층 도입 검토
  2. 애플리케이션 계층 인터페이스화를 통해 테스트 대역 주입 용이성 강화
  3. 인프라 계층에 영속성/이벤트/메시징 어댑터 추가 시 패키지 구조 재사용
