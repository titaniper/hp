# User Stories — Joopang

## 1. 고객 경험

### Story 1 — 카탈로그 탐색
As a 비회원, I want 상품을 카테고리와 정렬 조건으로 탐색하고 싶다, so that 구매 결정을 위한 정보를 빠르게 찾을 수 있다.
- **Acceptance Criteria**
  - 카테고리, 가격/인기/최신 정렬 파라미터를 조합해 상품 목록을 요청할 수 있다.
  - 응답에는 선택한 로캘 기준의 상품명, 가격, 재고 상태가 포함된다.
  - 인기 상품 Top 5 API는 최근 3일 데이터를 기준으로 시장별 결과를 반환한다.

### Story 2 — 장바구니 영속화
As a 회원 고객, I want 로그인 상태의 장바구니를 유지하고 싶다, so that 여러 기기에서 담은 상품을 잃지 않고 결제를 준비할 수 있다.
- **Acceptance Criteria**
  - 로그인 사용자가 장바구니에 상품을 추가/수정/삭제하면 서버에 즉시 반영된다.
  - 담기 요청이 재고 또는 구매 한도를 초과하면 실패 사유가 응답된다.
  - 비회원 세션 장바구니는 로그인 시 계정 장바구니와 병합 규칙을 따른다.

### Story 3 — 쿠폰 적용
As a 회원 고객, I want 선착순 쿠폰을 발급받고 적용하고 싶다, so that 결제 금액을 절감할 수 있다.
- **Acceptance Criteria**
  - 유효 기간, 잔여 수량, 사용자 한도 검증을 통과하면 쿠폰 발급이 완료된다.
  - 체크아웃 요청 시 쿠폰 ID를 전달하면 할인 금액이 계산되고 응답에 반영된다.
  - 이미 사용했거나 조건을 충족하지 못한 쿠폰은 명확한 오류 코드로 거절된다.

### Story 4 — 주문 생성
As a 회원 고객, I want 체크아웃을 통해 주문을 생성하고 싶다, so that 원하는 상품을 결제하고 배송 받을 수 있다.
- **Acceptance Criteria**
  - 주문 생성 요청에는 멱등 키가 포함되며, 동일 키 재시도 시 중복 주문이 생성되지 않는다.
  - 재고와 잔액 검증이 성공하면 주문이 `PAID` 상태로 생성되고 재고가 차감된다.
  - 검증 실패 시 적절한 오류 코드와 메시지가 반환되고 재고는 유지된다.

### Story 5 — 주문 조회 및 취소
As a 회원 고객, I want 주문 내역을 조회하고 필요한 경우 취소하고 싶다, so that 배송 전 주문을 스스로 관리할 수 있다.
- **Acceptance Criteria**
  - 고객은 주문 목록과 주문 상세 API를 통해 상태, 결제 금액, 사용 쿠폰을 확인할 수 있다.
  - `PENDING` 또는 `PAID` 상태의 주문은 취소 API를 통해 취소가 가능하다.
  - 취소 성공 시 재고와 잔액이 자동으로 복원되고 취소 사유가 기록된다.

## 2. 내부 운영

### Story 6 — 재고 조정
As a 재고 관리자, I want 재고 수량을 조정하고 감사 로그를 남기고 싶다, so that 실제 재고와 시스템 재고를 일치시킬 수 있다.
- **Acceptance Criteria**
  - 입고/조정 API는 SKU, 수량, 사유, 담당자를 필수로 받는다.
  - 성공 시 재고 수량이 즉시 반영되고 감사 로그가 생성된다.
  - 재고 변경 이벤트가 분석 시스템으로 발행되어야 한다.

### Story 7 — 쿠폰 캠페인 관리
As a 마케팅 관리자, I want 쿠폰 캠페인을 구성하고 잔량을 모니터링하고 싶다, so that 프로모션 효과를 최적화할 수 있다.
- **Acceptance Criteria**
  - 관리자 API를 통해 쿠폰 수량, 할인 규칙, 대상 상품/카테고리를 설정할 수 있다.
  - 발급/사용 현황을 조회하면 실시간 잔여 수량과 사용자별 사용 이력이 제공된다.
  - 운영 중단이 필요한 쿠폰은 회수 API를 통해 즉시 비활성화된다.

### Story 8 — 고객 지원 처리
As a 고객 상담사, I want 주문과 쿠폰 사용 이력을 조회하고 환불을 처리하고 싶다, so that 고객 문의를 빠르게 해결할 수 있다.
- **Acceptance Criteria**
  - 상담사 권한으로 고객별 주문 리스트와 세부 사항을 조회할 수 있다.
  - 정책 범위 내 환불 요청 시 결제 취소 및 잔액 복원이 자동으로 처리된다.
  - 상담사는 재고 수정 권한이 없으며 시도 시 권한 오류가 반환된다.

### Story 9 — 운영 모니터링
As a 운영 관리자, I want 외부 데이터 연동 상태와 핵심 지표를 모니터링하고 싶다, so that 장애를 조기에 감지하고 대응할 수 있다.
- **Acceptance Criteria**
  - 운영 대시보드는 주문/재고/쿠폰 관련 핵심 지표(P95 지연, 성공률)를 표시한다.
  - 외부 데이터 플랫폼 전송 실패 시 알람이 생성되고 재전송을 수동으로 트리거할 수 있다.
  - 시스템 설정 변경 시 감사 로그와 승인 워크플로우가 남는다.

### Story 10 — 데이터 전달
As an 외부 데이터 플랫폼, I want 주문 및 쿠폰 이벤트를 안정적으로 수신하고 재전송을 요청하고 싶다, so that 분석 파이프라인을 정확하게 유지할 수 있다.
- **Acceptance Criteria**
  - 아웃박스 엔드포인트는 보안 채널로 인증된 요청만 허용한다.
  - 이벤트 소비 후 승인 응답을 보내면 해당 이벤트가 전송 완료로 표시된다.
  - 처리 실패 시 재전송 요청을 보내면 큐에 재적재되어 다시 전달된다.
